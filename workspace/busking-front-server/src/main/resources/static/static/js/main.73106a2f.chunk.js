(this["webpackJsonpopenvidu-react"]=this["webpackJsonpopenvidu-react"]||[]).push([[0],{124:function(e,t,n){},126:function(e,t,n){},127:function(e,t,n){"use strict";n.r(t);var s=n(5),i=n.n(s),a=n(62),r=n.n(a),o=(n(68),n(4)),c=n(16),u=n(12),d=n(14),l=n(6),h=n(15),b=n(13),v=n(63),m=n(31),p=n.n(m),f=(n(124),n(0)),j=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).videoRef=i.a.createRef(),s}return Object(d.a)(n,[{key:"componentDidUpdate",value:function(e){e&&this.videoRef&&this.props.streamManager.addVideoElement(this.videoRef.current)}},{key:"componentDidMount",value:function(){this.props&&this.videoRef&&this.props.streamManager.addVideoElement(this.videoRef.current)}},{key:"render",value:function(){return Object(f.jsx)("video",{autoPlay:!0,ref:this.videoRef})}}]),n}(s.Component),g=(n(126),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"getNicknameTag",value:function(){return JSON.parse(this.props.streamManager.stream.connection.data).clientData}},{key:"render",value:function(){return Object(f.jsx)("div",{children:void 0!==this.props.streamManager?Object(f.jsxs)("div",{className:"streamcomponent",children:[Object(f.jsx)(j,{streamManager:this.props.streamManager}),Object(f.jsx)("div",{children:Object(f.jsx)("p",{children:this.getNicknameTag()})})]}):null})}}]),n}(s.Component)),O="https://i9c108.p.ssafy.io/",x=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).state={mySessionId:"ssafy_1",myUserName:"SSAFY "+Math.floor(50*Math.random()),session:void 0,mainStreamManager:void 0,publisher:void 0,subscribers:[]},s.joinSession=s.joinSession.bind(Object(l.a)(s)),s.leaveSession=s.leaveSession.bind(Object(l.a)(s)),s.switchCamera=s.switchCamera.bind(Object(l.a)(s)),s.handleChangeSessionId=s.handleChangeSessionId.bind(Object(l.a)(s)),s.handleChangeUserName=s.handleChangeUserName.bind(Object(l.a)(s)),s.handleMainVideoStream=s.handleMainVideoStream.bind(Object(l.a)(s)),s.onbeforeunload=s.onbeforeunload.bind(Object(l.a)(s)),s}return Object(d.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("beforeunload",this.onbeforeunload)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.onbeforeunload)}},{key:"onbeforeunload",value:function(e){this.leaveSession()}},{key:"handleChangeSessionId",value:function(e){this.setState({mySessionId:e.target.value})}},{key:"handleChangeUserName",value:function(e){this.setState({myUserName:e.target.value})}},{key:"handleMainVideoStream",value:function(e){this.state.mainStreamManager!==e&&this.setState({mainStreamManager:e})}},{key:"deleteSubscriber",value:function(e){var t=this.state.subscribers,n=t.indexOf(e,0);n>-1&&(t.splice(n,1),this.setState({subscribers:t}))}},{key:"joinSession",value:function(){var e=this;this.OV=new v.OpenVidu,this.setState({session:this.OV.initSession()},(function(){var t=e.state.session;t.on("streamCreated",(function(n){var s=t.subscribe(n.stream,void 0),i=e.state.subscribers;i.push(s),e.setState({subscribers:i})})),t.on("streamDestroyed",(function(t){e.deleteSubscriber(t.stream.streamManager)})),t.on("exception",(function(e){console.warn(e)})),e.getToken().then((function(n){t.connect(n,{clientData:e.state.myUserName}).then(Object(c.a)(Object(o.a)().mark((function n(){var s,i,a,r,c;return Object(o.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.OV.initPublisherAsync(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:!0,publishVideo:!0,resolution:"640x480",frameRate:30,insertMode:"APPEND",mirror:!0});case 2:return s=n.sent,t.publish(s),n.next=6,e.OV.getDevices();case 6:i=n.sent,a=i.filter((function(e){return"videoinput"===e.kind})),r=s.stream.getMediaStream().getVideoTracks()[0].getSettings().deviceId,c=a.find((function(e){return e.deviceId===r})),e.setState({currentVideoDevice:c,mainStreamManager:s,publisher:s});case 11:case"end":return n.stop()}}),n)})))).catch((function(e){console.log("There was an error connecting to the session:",e.code,e.message)}))}))}))}},{key:"leaveSession",value:function(){var e=this.state.session;e&&e.disconnect(),this.OV=null,this.setState({session:void 0,subscribers:[],mySessionId:"SessionA",myUserName:"Participant"+Math.floor(100*Math.random()),mainStreamManager:void 0,publisher:void 0})}},{key:"switchCamera",value:function(){var e=Object(c.a)(Object(o.a)().mark((function e(){var t,n,s,i,a=this;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.OV.getDevices();case 3:if(t=e.sent,!((n=t.filter((function(e){return"videoinput"===e.kind})))&&n.length>1)){e.next=14;break}if(!((s=n.filter((function(e){return e.deviceId!==a.state.currentVideoDevice.deviceId}))).length>0)){e.next=14;break}return i=this.OV.initPublisher(void 0,{videoSource:s[0].deviceId,publishAudio:!0,publishVideo:!0,mirror:!0}),e.next=11,this.state.session.unpublish(this.state.mainStreamManager);case 11:return e.next=13,this.state.session.publish(i);case 13:this.setState({currentVideoDevice:s[0],mainStreamManager:i,publisher:i});case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.error(e.t0);case 19:case"end":return e.stop()}}),e,this,[[0,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.mySessionId,n=this.state.myUserName;return Object(f.jsxs)("div",{className:"container",children:[void 0===this.state.session?Object(f.jsxs)("div",{id:"join",children:[Object(f.jsx)("div",{id:"img-div",children:Object(f.jsx)("img",{src:"resources/images/ssabus.png",alt:"OpenVidu logo"})}),Object(f.jsxs)("div",{id:"join-dialog",className:"jumbotron vertical-center",children:[Object(f.jsx)("h1",{children:" \ub300\uc131\uc774\uc640 \ub7ec\uc9c0\ub4e4 "}),Object(f.jsx)("h3",{className:"subTitle",children:" \ubabb\ub09c\ub188\ub4e4\uc740 \uc11c\ub85c \uc5bc\uad74\ub9cc \ubd10\ub3c4 \ud765\uacb9\ub2e4."}),Object(f.jsxs)("form",{className:"form-group",onSubmit:this.joinSession,children:[Object(f.jsxs)("p",{children:[Object(f.jsx)("label",{children:"\ub2c9\ub124\uc784\uc744 \uc785\ub825\ud558\uc138\uc694 "}),Object(f.jsx)("input",{className:"form-control",type:"text",id:"userName",value:n,onChange:this.handleChangeUserName,required:!0})]}),Object(f.jsxs)("p",{children:[Object(f.jsx)("label",{children:" \uc811\uc18d\ud560 \uc138\uc158\uc744 \uc785\ub825\ud558\uc138\uc694 "}),Object(f.jsx)("input",{className:"form-control",type:"text",id:"sessionId",value:t,onChange:this.handleChangeSessionId,required:!0})]}),Object(f.jsx)("p",{className:"text-center",children:Object(f.jsx)("input",{className:"btn btn-lg btn-success",name:"commit",type:"submit",value:"\uc785\uc7a5\ud558\uae30"})})]})]})]}):null,void 0!==this.state.session?Object(f.jsxs)("div",{id:"session",children:[Object(f.jsxs)("div",{id:"session-header",children:[Object(f.jsx)("h1",{id:"session-title",children:"C108 : \ud3b8\uc548\ud55c42"}),Object(f.jsx)("input",{className:"btn btn-large btn-danger",type:"button",id:"buttonLeaveSession",onClick:this.leaveSession,value:"\ube68\uac04\uc0c9 \ubc84\ud2bc"}),Object(f.jsx)("input",{className:"btn btn-large btn-success",type:"button",id:"buttonSwitchCamera",onClick:this.switchCamera,value:"\ucd08\ub85d\uc0c9 \ubc84\ud2bc"})]}),void 0!==this.state.mainStreamManager?Object(f.jsx)("div",{id:"main-video",className:"col-md-6",children:Object(f.jsx)(g,{streamManager:this.state.mainStreamManager})}):null,Object(f.jsxs)("div",{id:"video-container",className:"col-md-6",children:[void 0!==this.state.publisher?Object(f.jsx)("div",{className:"stream-container col-md-6 col-xs-6",onClick:function(){return e.handleMainVideoStream(e.state.publisher)},children:Object(f.jsx)(g,{streamManager:this.state.publisher})}):null,this.state.subscribers.map((function(t,n){return Object(f.jsxs)("div",{className:"stream-container col-md-6 col-xs-6",onClick:function(){return e.handleMainVideoStream(t)},children:[Object(f.jsx)("span",{children:t.id}),Object(f.jsx)(g,{streamManager:t})]},t.id)}))]})]}):null]})}},{key:"getToken",value:function(){var e=Object(c.a)(Object(o.a)().mark((function e(){var t;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createSession(this.state.mySessionId);case 2:return t=e.sent,e.next=5,this.createToken(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createSession",value:function(){var e=Object(c.a)(Object(o.a)().mark((function e(t){var n;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post(O+"api/sessions",{customSessionId:t},{headers:{"Content-Type":"application/json"}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"createToken",value:function(){var e=Object(c.a)(Object(o.a)().mark((function e(t){var n;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post(O+"api/sessions/"+t+"/connections",{},{headers:{"Content-Type":"application/json"}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(s.Component),S=x,y=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function k(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}r.a.render(Object(f.jsx)(S,{}),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");y?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):k(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):k(e)}))}}()},68:function(e,t,n){}},[[127,1,2]]]);
//# sourceMappingURL=main.73106a2f.chunk.js.map